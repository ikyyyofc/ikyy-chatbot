:root {
  /* Design tokens */
  --bg: #0b1020;
  --bg-2: #0f172a;
  --panel: rgba(17, 24, 39, 0.72);
  --panel-strong: rgba(17, 24, 39, 0.9);
  --panel-border: #1f2a44;
  --muted: #99a9c2;
  --text: #e6ebf5;
  --text-soft: #cbd5e1;
  --accent: #7c3aed; /* violet */
  --accent-2: #22d3ee; /* cyan */
  --accent-strong: #6d28d9;
  --bubble-user: linear-gradient(135deg, #306af0, #2156d7);
  --bubble-assistant: linear-gradient(180deg, rgba(36,48,69,.88), rgba(28,39,64,.82));
  --shadow: 0 10px 30px rgba(0,0,0,0.35);
  --radius-sm: 10px; --radius-md: 14px; --radius-lg: 18px;
  --ring: 0 0 0 3px rgba(124,58,237,.15);
}

/* Light theme tokens */
html[data-theme='light'] {
  --bg: #f6f7fb;
  --bg-2: #eef1f7;
  --panel: rgba(255,255,255,0.86);
  --panel-strong: rgba(255,255,255,0.95);
  --panel-border: #dbe2f1;
  --muted: #667085;
  --text: #0f172a;
  --text-soft: #334155;
  --accent: #7c3aed;
  --accent-2: #06b6d4;
  --accent-strong: #6d28d9;
  --bubble-user: linear-gradient(135deg, #2563eb, #1d4ed8);
  --bubble-assistant: linear-gradient(180deg, rgba(248,250,252,.92), rgba(241,245,249,.88));
  --shadow: 0 10px 28px rgba(2,6,23,.12);
}

* { box-sizing: border-box }
html, body, #root { height: 100% }
body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  color: var(--text);
  background:
    radial-gradient(1200px 600px at 80% -10%, rgba(124,58,237,.18), transparent 45%),
    radial-gradient(900px 500px at 0% 100%, rgba(34,211,238,.12), transparent 50%),
    linear-gradient(180deg, var(--bg), var(--bg-2));
}

body::after { content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
  background-image: linear-gradient(to right, rgba(255,255,255,.04) 1px, transparent 1px),
                    linear-gradient(to bottom, rgba(255,255,255,.04) 1px, transparent 1px);
  background-size:28px 28px; opacity:.15 }

.app { display: grid; grid-template-rows: auto 1fr auto; height: 100%; max-width: 980px; margin: 0 auto; padding: 0 12px }

.header {
  display: flex; align-items: center; justify-content: space-between; gap: 12px;
  padding: 12px 16px; position: sticky; top: 0; z-index: 20;
  background: linear-gradient(180deg, var(--panel-strong), var(--panel));
  backdrop-filter: saturate(160%) blur(14px);
  border-bottom: 1px solid var(--panel-border);
}
.header{ position: sticky }
.header::after { content: ""; position: absolute; left: 0; right: 0; top: 0; height: 2px;
  background: linear-gradient(90deg, transparent, var(--accent) 20%, var(--accent-2) 50%, var(--accent) 80%, transparent);
  opacity: .25; pointer-events: none }
.title { font-weight: 800; letter-spacing: .2px; display: inline-flex; align-items: center; gap: 10px; background: linear-gradient(90deg, #a78bfa, #22d3ee 60%, #a78bfa); -webkit-background-clip: text; background-clip: text; color: transparent }
.title:before { content: ""; display: inline-block; width: 10px; height: 10px; border-radius: 9999px; background: conic-gradient(from 0deg, var(--accent), var(--accent-2)); box-shadow: 0 0 16px rgba(124,58,237,.7) }
.brand{ position: absolute; left: 50%; top: 6px; transform: translateX(-50%); text-align: center; pointer-events: none; width: max-content }
.brand-title{ font-family: 'Orbitron', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; font-weight: 800; letter-spacing: .6px; 
  background: linear-gradient(90deg, #c4b5fd, #22d3ee 60%, #c4b5fd); -webkit-background-clip: text; background-clip: text; color: transparent;
  font-size: clamp(18px, 2.4vw, 22px); line-height: 1.1 }
.brand-sub{ font-family: 'Sora', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; font-weight: 600; 
  font-size: clamp(11px, 1.6vw, 13px); color: var(--muted); margin-top: 3px; display: inline-flex; align-items: center; gap: 3px; justify-content: center; letter-spacing: .3px }
.typing-text{ display:inline-block; white-space:nowrap }
.caret{ width:1px; height: 1em; background: var(--text); display:inline-block; animation: blinkCaret 1s step-end infinite }
@keyframes blinkCaret { 0%, 100% { opacity: 0 } 50% { opacity: 1 } }
.controls { display: flex; gap: 8px; align-items: center; flex-wrap: nowrap }
.reset-btn{ display:inline-grid; place-items:center; width:36px; height:36px; border-radius:10px; background: transparent; color: var(--text); border:1px solid var(--panel-border); cursor:pointer }
.reset-btn svg{ width:18px; height:18px }
.reset-btn, .hamburger{ outline: none; box-shadow: none; -webkit-tap-highlight-color: transparent }
.reset-btn:focus, .reset-btn:focus-visible, .reset-btn:active,
.hamburger:focus, .hamburger:focus-visible, .hamburger:active{ outline: none; box-shadow: none; background: transparent }
.hamburger{ display:inline-flex; flex-direction:column; align-items:center; justify-content:center; gap:3px; width:36px; height:36px; border-radius:10px; background: transparent; color: var(--text); border:1px solid var(--panel-border); cursor:pointer }
.hamburger .bar{ width:18px; height:2px; background: var(--text); border-radius:2px }
.hamburger.open .bar:nth-child(1){ transform: translateY(5px) rotate(45deg); transition: transform .2s ease }
.hamburger.open .bar:nth-child(2){ opacity:0; transition: opacity .2s ease }
.hamburger.open .bar:nth-child(3){ transform: translateY(-5px) rotate(-45deg); transition: transform .2s ease }
.nav-menu{ position:absolute; right: 16px; top: 56px; display:flex; flex-direction:column; gap:6px; padding:10px; border:1px solid var(--panel-border); border-radius:12px; background: linear-gradient(180deg, var(--panel-strong), var(--panel)); box-shadow: 0 12px 30px rgba(0,0,0,.35) }
.nav-menu{ transform: translateY(-6px); opacity: 0; animation: menuIn .18s ease forwards }
.nav-menu a{ transition: background .15s ease, color .15s ease }
.nav-menu a:active{ transform: translateY(1px) }
.scroll-down{ position: fixed; right: 20px; bottom: 86px; width: 36px; height: 36px; border-radius: 999px; border: 1px solid var(--panel-border); background: linear-gradient(180deg, var(--panel-strong), var(--panel)); color: var(--text); box-shadow: 0 10px 24px rgba(0,0,0,.35); cursor: pointer }
/* Remove blue highlight/focus ring on scroll-down */
.scroll-down{ outline: none; box-shadow: 0 10px 24px rgba(0,0,0,.35); -webkit-tap-highlight-color: transparent }
.scroll-down:focus, .scroll-down:focus-visible, .scroll-down:active{ outline: none; box-shadow: 0 10px 24px rgba(0,0,0,.35); background: linear-gradient(180deg, var(--panel-strong), var(--panel)) }
@keyframes menuIn { to { transform: translateY(0); opacity: 1 } }
.nav-menu a{ color: var(--text); text-decoration:none; padding:6px 8px; border-radius:8px; display:flex; align-items:center; gap:8px; outline: none; -webkit-tap-highlight-color: transparent }
.nav-menu a:focus, .nav-menu a:focus-visible, .nav-menu a:active{ outline: none; box-shadow: none; background: transparent }
.nav-menu a svg{ width:16px; height:16px; display:block }
.nav-menu a:hover{ background: rgba(255,255,255,.06) }
html[data-theme='light'] .hamburger{ border-color: rgba(2,6,23,.12) }
html[data-theme='light'] .nav-menu{ background: rgba(255,255,255,.95); border-color: rgba(2,6,23,.12) }
html[data-theme='light'] .nav-menu a:hover{ background: rgba(2,6,23,.06) }
.controls select {
  background: transparent; color: var(--text); border: 1px solid var(--panel-border);
  border-radius: var(--radius-sm); padding: 8px 10px; outline: none; transition: border-color .2s ease, background .2s ease
}
.controls select:focus { border-color: #334567 }
.controls .secondary { background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.04)); color: var(--text); border: 1px solid var(--panel-border); border-radius: var(--radius-sm); padding: 8px 12px; cursor: pointer; transition: transform .15s ease, filter .15s ease }
.controls .secondary:hover { color: var(--text); border-color: #334567; transform: translateY(-1px) }

.chat { padding: 14px 8px 8px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; scroll-behavior: smooth }
.chat::after{ content: none; display: none }
html[data-theme='light'] .chat::after{ content: none; display: none }
.msg { display: grid; grid-template-columns: 30px 1fr 30px; gap: 6px; align-items: end; animation: slideUp .18s ease-out both }
.msg.user { grid-template-columns: 30px 1fr 30px }
.msg.assistant .bubble { justify-self: start }
.msg.user .bubble { justify-self: end }
.spacer { width: 30px; height: 30px }
.avatar { width: 30px; height: 30px; border-radius: 50%; display: grid; place-items: center; background: #0b1426; border: 1px solid var(--panel-border); box-shadow: none; color: #c7d2fe; font-size: 13px; overflow: hidden }
.avatar.assistant { background: radial-gradient(circle at 30% 20%, rgba(124,58,237,.6), transparent 55%), radial-gradient(circle at 70% 80%, rgba(34,211,238,.5), transparent 45%), #0b1426 }
.avatar.user { background: radial-gradient(circle at 30% 20%, rgba(59,130,246,.55), transparent 55%), radial-gradient(circle at 70% 80%, rgba(34,197,94,.45), transparent 45%), #0b1426 }
.msg.user .avatar { justify-self: end }
.avatar-emoji { font-size: 16px; line-height: 1 }
.bubble { max-width: min(88%, 820px); padding: 8px 10px; border-radius: var(--radius-md); line-height: 1.45; box-shadow: none; position: relative; transition: transform .12s ease, border-color .2s ease; overflow: hidden; border: 1px solid rgba(255,255,255,.04) }
.bubble-inner { font-size: 13.8px; line-height: 1.45; overflow-x: visible }
.bubble:hover { transform: translateY(-2px) }
.msg.user .bubble { background: var(--bubble-user); color: white; border-bottom-right-radius: 6px }
.msg.assistant .bubble { background: var(--bubble-assistant); color: var(--text); border-bottom-left-radius: 6px; border: 1px solid rgba(255,255,255,.06) }
html[data-theme='light'] .msg.assistant .bubble { border-color: rgba(2,6,23,.06) }
.msg.assistant .bubble::after { content: ""; position: absolute; left: -6px; bottom: 10px; border-right: 6px solid var(--bubble-assistant); border-top: 6px solid transparent; border-bottom: 6px solid transparent; filter: none }
.msg.user .bubble::after { content: ""; position: absolute; right: -6px; bottom: 10px; border-left: 6px solid #1e40af; border-top: 6px solid transparent; border-bottom: 6px solid transparent; filter: none }
.bubble.appear { animation: pop .18s ease-out }

/* Enhanced markdown typography */
.bubble-inner h1{font-size:1.35rem}
.bubble-inner h2{font-size:1.2rem}
.bubble-inner h3{font-size:1.1rem}
.bubble-inner strong{color:var(--text); font-weight:700}
.bubble-inner em{color:var(--text-soft)}
.bubble-inner hr{border:0; height:1px; background: rgba(255,255,255,.08); margin:10px 0}
html[data-theme='light'] .bubble-inner hr{ background: rgba(2,6,23,.08) }
.bubble-inner blockquote{margin:8px 0; padding:8px 10px; border-left:3px solid var(--accent); background: rgba(255,255,255,.04); border-radius: 0 10px 10px 0}
html[data-theme='light'] .bubble-inner blockquote{ background: rgba(2,6,23,.04) }
.bubble-inner table{ display:block; width:max-content; max-width: 100%; overflow-x:auto; border-collapse: collapse; margin:8px 0; font-size: 0.95em; background: rgba(7,12,22,.7); border:1px solid rgba(255,255,255,.06); border-radius: 12px; box-shadow: none }
html[data-theme='light'] .bubble-inner table{ background: rgba(255,255,255,.95); border-color: rgba(2,6,23,.08); box-shadow: none }
.bubble-inner th,.bubble-inner td{ border:1px solid rgba(255,255,255,.08); padding:6px 8px; text-align:left }
html[data-theme='light'] .bubble-inner th, html[data-theme='light'] .bubble-inner td{ border-color: rgba(2,6,23,.08) }
.bubble-inner th{ background: rgba(255,255,255,.06); font-weight:600 }
html[data-theme='light'] .bubble-inner th{ background: rgba(2,6,23,.06) }

.composer { position: sticky; bottom: 0; background: transparent; padding: 22px 12px 28px; border-top: none }
.composer-inner { display: grid; grid-template-columns: 1fr; gap: 10px; align-items: end; max-width: 980px; margin: 0 auto }
.textarea-wrap { position: relative; display: flex; align-items: center; min-height: 56px; border-radius: 18px; padding: 4px; background: linear-gradient(180deg, var(--panel-strong), var(--panel)); border: 1px solid var(--panel-border); box-shadow: none }
.textarea-wrap{ backdrop-filter: blur(6px) saturate(140%) }
.textarea-wrap::before, .textarea-wrap::after { content: none }
.composer textarea { width: 100%; resize: none; max-height: 40vh; overflow: auto; background: transparent; color: var(--text); border: 0; border-radius: 0; padding: 12px 56px 12px 12px; outline: none; transition: color .2s ease }
.composer textarea:focus { color: var(--text) }
.composer textarea::placeholder { color: #93a1b7 }
html[data-theme='light'] .composer { background: transparent }
html[data-theme='light'] .textarea-wrap { background: rgba(255,255,255,.95); border-color: rgba(2,6,23,.06); box-shadow: 0 10px 28px rgba(2,6,23,.12) }
.icon-btn { border: none; cursor: pointer; font-weight: 700 }
.send-icon { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 36px; height: 36px; display: grid; place-items: center; border-radius: 999px; color: var(--text); background: transparent; border: 1px solid rgba(255,255,255,.12); transition: none; z-index: 2; outline: none; box-shadow: none; -webkit-tap-highlight-color: transparent }
.send-icon:disabled { opacity: .6; cursor: not-allowed }
.send-icon:not(:disabled):hover { transform: translateY(-50%) }
.send-icon.stop { border-color: rgba(239,68,68,.5); color: #fff; background: linear-gradient(135deg, #ef4444, #dc2626) }
/* Remove blue focus ring and tap highlight on send button */
.send-icon:focus, .send-icon:focus-visible, .send-icon:active { outline: none; box-shadow: none }
.composer textarea { -webkit-tap-highlight-color: transparent; outline: none }
html[data-theme='light'] .send-icon { border-color: rgba(2,6,23,.15); color: #0f172a }
html[data-theme='light'] .textarea-wrap::before { background: rgba(2,6,23,.1) }
html[data-theme='light'] .textarea-wrap{ backdrop-filter: blur(6px) saturate(140%) }

/* Loading glow removed per request */

/* Background animation defined earlier via body::before/body::after */

.typing { display: inline-flex; gap: 6px; align-items: center }
.dot { width: 6px; height: 6px; background: #9ca3af; border-radius: 9999px; animation: blink 1.4s infinite both }
.dot:nth-child(2) { animation-delay: .2s }
.dot:nth-child(3) { animation-delay: .4s }
@keyframes blink { 0%, 80%, 100% { opacity: .2 } 40% { opacity: 1 } }

@keyframes pop { 0% { transform: scale(.98); opacity: .0 } 100% { transform: scale(1); opacity: 1 } }
@keyframes slideUp { 0% { transform: translateY(6px); opacity: .0 } 100% { transform: translateY(0); opacity: 1 } }

/* Responsive tweaks */
@media (max-width: 640px) {
  .app { padding: 0 6px }
  .header { padding: 10px 10px }
  .title { font-size: 14px }
  .controls { width: 100%; justify-content: space-between; gap: 6px }
  .controls select { padding: 6px 8px; font-size: 12px; border-radius: 8px }
  .controls .secondary { padding: 6px 8px; font-size: 12px; border-radius: 8px }

  .chat { padding: 10px 4px 6px; gap: 6px }
  .msg { grid-template-columns: 24px 1fr 24px }
  .msg.user { grid-template-columns: 24px 1fr 24px }
  .avatar, .spacer { width: 24px; height: 24px }
  .avatar-emoji { font-size: 13px }

  .bubble { max-width: 98%; padding: 7px 9px; border-radius: 12px }
  .bubble-inner { font-size: 13px; line-height: 1.45 }
  .typing .dot { width: 5px; height: 5px }

  .composer { padding: 10px 6px 12px }
  .textarea-wrap { min-height: 44px }
  .composer textarea { padding: 6px 44px 8px 2px; font-size: 13.5px }
  .send-icon { width: 30px; height: 30px; right: 4px }

  /* Code blocks compact */
  .codeblock { margin: 6px 0; border-radius: 10px }
  .code-header { padding: 5px 8px }
  .code-header .lang { font-size: 11px }
  .codeblock > code { padding: 8px 10px }
  .inline-code { padding: 1px 4px; border-radius: 5px }

  .bubble-actions { right: 4px; top: 4px; gap: 4px }
  .action { padding: 3px 6px; font-size: 12px }
  /* Disable heavy background blur on low width */
  .msg.assistant .bubble { box-shadow: 0 6px 16px rgba(0,0,0,.24) }
}

@media (max-width: 380px) {
  .controls select { max-width: 52vw }
  .title { display: none }
}

/* Markdown styles */
.bubble-inner h1,.bubble-inner h2,.bubble-inner h3{margin:8px 0 6px;font-weight:700}
.bubble-inner p{margin:4px 0}
.bubble-inner code{background:rgba(255,255,255,.06);padding:2px 6px;border-radius:6px}
.bubble-inner pre{background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.05);padding:12px;border-radius:12px;overflow:auto;margin:10px 0}
.bubble-inner pre code{background:transparent;padding:0}
.bubble-inner ul{padding-left:16px}
.bubble-inner p, .bubble-inner li { white-space: pre-wrap }
/* Minimal KaTeX tweaks */
.bubble-inner .katex { color: var(--text) }
.bubble-inner .katex-display { overflow-x:auto; margin: 8px 0; padding: 8px 10px; background: rgba(7,12,22,.7); border:1px solid rgba(255,255,255,.06); border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,.20) }
html[data-theme='light'] .bubble-inner .katex-display{ background: rgba(255,255,255,.95); border-color: rgba(2,6,23,.08); box-shadow: 0 8px 22px rgba(2,6,23,.10) }

.action{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.08);color:#dbeafe;border-radius:8px;padding:4px 8px;cursor:pointer}
.action:hover{background:rgba(255,255,255,.16)}
/* Scrollbar styling */
.chat { scrollbar-width: thin }
.chat::-webkit-scrollbar { width: 5px }
.chat::-webkit-scrollbar-track { background: transparent }
.chat::-webkit-scrollbar-thumb { background: rgba(148,163,184,.25); border-radius: 999px }
html[data-theme='light'] .chat::-webkit-scrollbar-thumb { background: rgba(15,23,42,.25) }

/* Make inner-scrollbars minimal as well (tables/math/code) */
.bubble-inner, .codeblock, .bubble-inner .katex-display {
  scrollbar-width: thin;
}
.bubble-inner::-webkit-scrollbar,
.codeblock::-webkit-scrollbar,
.bubble-inner .katex-display::-webkit-scrollbar { width: 6px; height: 6px }
.bubble-inner::-webkit-scrollbar-thumb,
.codeblock::-webkit-scrollbar-thumb,
.bubble-inner .katex-display::-webkit-scrollbar-thumb { background: rgba(148,163,184,.25); border-radius: 999px }

/* Light theme code colors */
html[data-theme='light'] .hljs{color:#0f172a}
html[data-theme='light'] .hljs-keyword,.hljs-selector-tag,.hljs-literal,.hljs-title,.hljs-section{color:#6d28d9}
html[data-theme='light'] .hljs-string{color:#16a34a}
html[data-theme='light'] .hljs-number{color:#be123c}
html[data-theme='light'] .hljs-comment{color:#64748b}

/* Reduce motion support */
@media (prefers-reduced-motion: reduce) {
  .bubble, .send-icon { transition: none }
  .bubble.appear, .msg { animation: none }
}

/* Actions row outside bubbles */
.msg-actions{ display:grid; grid-template-columns: 30px 1fr 30px; }

/* Credit badge */
.msg-actions.user{ grid-template-columns: 30px 1fr 30px }
.msg-actions .actions{ display:flex; gap:6px; justify-self:start; margin: 2px 0 6px }
.msg-actions.user .actions{ justify-self:end }

/* Link styling inside markdown (avoid default blue) */
.bubble-inner a{ color: var(--accent-2); text-decoration: underline; text-underline-offset: 2px; text-decoration-color: color-mix(in oklab, var(--accent-2) 60%, transparent) }
.bubble-inner a:hover{ filter: brightness(1.1) }
/* Code size overrides for small screens */
@media (max-width: 640px) {
  .codeblock > code { font-size: 11px; line-height: 1.45 }
  .inline-code { font-size: .85em }
}

/* Inline code and code blocks */
.inline-code{background:rgba(255,255,255,.06);padding:2px 6px;border-radius:6px;border:1px solid rgba(255,255,255,.06);font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:.9em}
.codeblock{background:rgba(7,12,22,.7);border:1px solid rgba(255,255,255,.06);border-radius:12px;overflow:auto;margin:10px 0;box-shadow: 0 6px 18px rgba(0,0,0,.30); max-height: 60vh}
.code-header{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg, rgba(18,26,44,.8), rgba(14,20,36,.6))}
.code-header .lang{font-size:11px;color:#9fb6ff;text-transform:lowercase}
.codeblock > code{display:block;padding:10px 12px;min-width:100%;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; line-height:1.5}

/* Custom highlight.js theme (dark violet-cyan) */
.hljs{color:#E6EBF5;background:transparent}
.hljs-keyword,.hljs-selector-tag,.hljs-literal,.hljs-title,.hljs-section{color:#c4b5fd}
.hljs-attribute,.hljs-name,.hljs-tag{color:#93c5fd}
.hljs-string,.hljs-meta .hljs-string,.hljs-bullet{color:#6ee7b7}
.hljs-number,.hljs-symbol,.hljs-meta{color:#fca5a5}
.hljs-built_in,.hljs-builtin-name{color:#f0abfc}
.hljs-attr,.hljs-params{color:#f9a8d4}
.hljs-type,.hljs-class{color:#fde68a}
.hljs-comment,.hljs-quote{color:#94a3b8}
.hljs-link{text-decoration:underline;color:#7dd3fc}
/* Diff additions/deletions */
.hljs-addition{ background: rgba(16,185,129,.18) }
.hljs-deletion{ background: rgba(239,68,68,.18) }
